[global]
error_log = {{ .Env.APP_BASEDIR_LOG }}/php_error.log
log_level = notice
daemonize = no

[www]
user = {{ .Env.SYSTEM_APPUSER_NAME }}
group = {{ .Env.SYSTEM_APPUSER_NAME }}

listen = /var/run/php-fpm-www.sock
listen.owner = {{ .Env.SYSTEM_APPUSER_NAME }}
listen.group = {{ .Env.SYSTEM_APPUSER_NAME }}

pm = dynamic
pm.max_children = {{ default .Env.PHPFPM_PM_MAX_CHILDREN "5" }}
pm.min_spare_servers = {{ default .Env.PHPFPM_PM_MIN_SPARE_SERVERS "1" }}
pm.max_spare_servers = {{ default .Env.PHPFPM_PM_MAX_SPARE_SERVERS "3" }}
pm.max_requests = {{ default .Env.PHPFPM_PM_MAX_REQUESTS "500" }}

chdir = /
clear_env = no
catch_workers_output = no
access.log = {{ .Env.APP_BASEDIR_LOG }}/php_access.log
access.format = "%{HTTP_X_TRACE_ID}e: %{REMOTE_ADDR}e - %u %t \"%m %r%{REQUEST_URI}e\" %s %{mili}d %{kilo}M %{user}C%% %{system}C%% %n"

php_admin_value[error_log] = {{ .Env.APP_BASEDIR_LOG }}/php_error.log
php_admin_flag[log_errors] = on
php_admin_value[slowlog] = {{ .Env.APP_BASEDIR_LOG }}/php_slow.log
php_value[memory_limit] = 256M
php_value[session.name] = SPAREPART_SID
php_value[session.hash_function] = 1
php_flag[session.cookie_httponly] = on
